<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kendama Open Comp Judge</title>
<style>
  #menuScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  #menuScreen h1 {
    color: white;
    margin-bottom: 30px;
    font-size: 32px;
  }

  .menu-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .list-button {
    padding: 20px 50px;
    font-size: 20px;
    margin: 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    min-width: 250px;
  }

  .list-button:hover {
    background: #0056b3;
  }

  .back-button {
    padding: 10px 30px;
    font-size: 16px;
    margin-top: 20px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }

  .back-button:hover {
    background: #5a6268;
  }

  #gameScreen {
    display: none;
  }

  #gameScreen.active {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .hidden {
    display: none !important;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f4f4f4;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .scoreboard {
    width: 95%;
    max-width: 600px;
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }

  .player {
    width: 48%;
    background: white;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  .player h2 { margin: 0; text-align: center; }
  .score { font-size: 40px; text-align: center; margin: 10px 0; }

  .cards {
    display: flex;
    flex-direction: column;
    gap: 5px;
    min-height: 40px;
  }

  .card {
    padding: 6px;
    background: #ddd;
    border-radius: 6px;
    font-size: 14px;
  }

  #currentTrickBox {
    margin-top: 20px;
    width: 95%;
    max-width: 600px;
    padding: 15px;
    background: white;
    text-align: center;
    border-radius: 10px;
    border: 4px solid black;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  #currentTrick { font-size: 22px; font-weight: bold; }

  .buttons {
    margin-top: 20px;
    display: flex;
    gap: 20px;
  }

  button {
    padding: 15px 25px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: #007bff;
    color: white;
    cursor: pointer;
  }

  button:active { opacity: 0.8; }
  
  button.cpu-thinking {
    animation: pulse 0.8s ease-in-out;
    pointer-events: none;
  }
  
  @keyframes pulse {
    0%, 100% { background: #28a745; transform: scale(1); }
    50% { background: #20c997; transform: scale(1.05); }
  }

  #newMatchBtn {
    margin-top: 25px;
    background: #28a745;
    display: none;
  }

  #middleCards {
    margin-top: 15px;
    font-size: 16px;
    min-height: 30px;
  }
</style>
</head>
<body>

<div id="menuScreen">
  <div id="modeSelect" class="menu-container">
    <h1>Welcome! Select Game Mode</h1>
    <button class="list-button" onclick="showDifficultyMenu('cpu')">Single Player (vs CPU)</button>
    <button class="list-button" onclick="showDifficultyMenu('two')">Two Player</button>
  </div>

  <div id="difficultySelect" class="menu-container hidden">
    <h1>Select Difficulty</h1>
    <button class="list-button" onclick="showTrickList('easy')">Easy</button>
    <button class="list-button" onclick="showTrickList('medium')">Medium</button>
    <button class="list-button" onclick="showTrickList('hard')">Hard</button>
    <button class="list-button" onclick="showTrickList('insane')">Ryoga on CRACK</button>
    <button class="back-button" onclick="backToModeSelect()">← Back</button>
  </div>

  <div id="trickListSelect" class="menu-container hidden">
    <h1>Select Trick List</h1>
    <button class="list-button" onclick="startGame('beginnerOpen')">Beginner Open</button>
    <button class="list-button" onclick="startGame('intermediateOpen')">Intermediate Open</button>
    <button class="list-button" onclick="startGame('advancedOpen')">Advanced Open</button>
    <button class="list-button" onclick="startGame('amOpen')">Am Open</button>
    <button class="list-button" onclick="startGame('proOpen')">Pro Open</button>
    <button class="list-button" onclick="startGame('top16')">Top 16</button>
    <button class="back-button" onclick="backToDifficulty()">← Back</button>
  </div>
</div>

<div id="gameScreen">

<div class="scoreboard">
  <div class="player" id="playerABox">
    <h2>Player A</h2>
    <div class="score" id="scoreA">0</div>
    <div class="cards" id="cardsA"></div>
  </div>

  <div class="player" id="playerBBox">
    <h2 id="playerBName">Player B</h2>
    <div class="score" id="scoreB">0</div>
    <div class="cards" id="cardsB"></div>
  </div>
</div>

<div id="currentTrickBox">
  <div id="setterLine">Setter: Player A</div>
  <div id="currentTrick">Press Draw Trick</div>
</div>

<div id="middleCards"></div>

<div class="buttons">
  <button onclick="drawTrick()">Draw Trick</button>
  <button id="makeBtn" onclick="recordMake()">Make</button>
  <button id="missBtn" onclick="recordMiss()">Miss</button>
  <button id="playerAPointBtn" class="hidden" onclick="quickPoint('A')">Player A Point</button>
  <button id="playerBPointBtn" class="hidden" onclick="quickPoint('B')">Player B Point</button>
  <button id="nullBtn" class="hidden" onclick="quickNull()">Null</button>
</div>

<div id="statusText" style="margin-top:10px; font-size:18px; font-weight:bold;">
  Draw a trick to begin
</div>

<button id="newMatchBtn" onclick="newMatch()">New Match</button>
<button class="back-button" onclick="backToMenu()" style="margin-top:10px;">← Back to Menu</button>

</div>

<script>
const proOpenTricks = [
  "Lunar, .5 Flip Tap, Lunar, In",
  "Airplane, 1.5 Swap Late Kenflip, Throw 1.5 In",
  "Airplane, 1.5 Swap Bird, Juggle 1.5-Turn Downspike",
  "Stunt Plane, Regular Stunt Flip Fasthand",
  "Triple Kenflip, 3-Turn Juggle Spike",
  "1-Turn Tap In, Inward Flip Tap 1-Turn In",
  "Switch Swing Spike, Whirlwind",
  "Wing Over Valley, Spike",
  "Candlestick, Inward 1.5 Swap Ken Grip Spike",
  "1-Turn 3-Tap, Swap Juggle Downspike",
  "Hanging Pinch Start, Flip Cushion In",
  "Gunslinger Handlestall, Gunslinger Spike",
  "Inward Stilt, .5 Lighthouse, .5 Inward Stilt, In",
  "Inward Lunar Back Flip, Trade Ken Grip Spike",
  "Kenflip, 3-Turn Juggle, Late Kenflip Spike"
];

const top16Tricks = [
  "Spike",
  "Around the World",
  "Lighthouse",
  "Lunar",
  "Airplane",
  "Bird",
  "Jumping Stick",
  "Gunslinger",
  "Handlestall",
  "Kenflip",
  "1-Turn Lighthouse",
  "Inward Lunar",
  "Swing Spike",
  "Juggle Spike",
  "Spacewalk"
];

const beginnerOpenTricks = [
  "Sara Grip Moshikame x 5",
  "Ken Grip Big Cup Spike",
  "Candlestick Grip Bottom Cup",
  "Ken Grip Big Cup, Orbit Big Cup",
  "Ken Grip Around Japan",
  "Sara Grip Around the Block",
  "Swing Spike",
  "Airplane",
  "Sara Grip Big Cup, Clack, Big Cup",
  "Lighthouse, In"
];

const intermediateOpenTricks = [
  "Around Europe",
  "Airplane, Jumping Stick",
  "One Turn Lighthouse, Trade Ken Grip Spike",
  "Big Cup, Juggle Big Cup, Spike",
  "Stunt Plane",
  "Hanging Pinch Start, In (Tama Grip Finish)",
  "Downspike",
  "Lunar, In",
  "Nightingale, Spike",
  "Swing Spike, Whirlwind"
];

const advancedOpenTricks = [
  "Inward Lunar, Inward Lunar Flip, Flip In",
  "Airplane, 1.5 Swap Spike",
  "1-Turn Lighthouse, 1-Turn Swap Spike",
  "Double Gunslinger Spike",
  "Stilt, Flip In",
  "Spacewalk Swap Spike",
  "Stunt Plane Fasthand, Whirlwind",
  "Juggle Spike",
  "Bird Over the Valley, Flip In (Tama Grip Finish)",
  "Candlestick Bottom Cup, Swap Ken Grip Spike"
];

const amOpenTricks = [
  "Handlestall, Ringstall, Spike",
  "1-Turn Tap Juggle Spike",
  "Stilt, Over the Valley, In",
  "Airplane, Triple Jumping Stick",
  "Switch Lighthouse, In",
  "Airplane, Cushion Tap In",
  "Lunar, Lunar Barrel Roll, In",
  "Lightning Drop In",
  "Wing, Spike",
  "Inward Gunslinger Downspike",
  "Downspike, Juggle Downspike",
  "Candlestick Flip, Trade Ken Grip Spike",
  "Underbird Nod-Off, Flip In (Tama Grip Finish)",
  "Stunt Plane, Inward Stunt Flip",
  "1-Turn Tap Lighthouse, Flip Tap Lighthouse, In"
];

let tricks = [];
let availableTricks = [];
let scoreA = 0;
let scoreB = 0;
let setter = "A";
let turn = "A";
let currentTrick = null;
let attemptHistory = [];
let retryCount = 0;
let gameMode = 'two'; // 'two' or 'cpu'
let cpuDifficulty = 'easy'; // 'easy', 'medium', 'hard', 'insane'
let cpuMakeRate = 0.3; // Default for easy

function showDifficultyMenu(mode) {
  gameMode = mode;
  document.getElementById('modeSelect').classList.add('hidden');
  
  if (mode === 'cpu') {
    document.getElementById('difficultySelect').classList.remove('hidden');
  } else {
    // Two player mode - skip to trick list
    document.getElementById('trickListSelect').classList.remove('hidden');
  }
}

function showTrickList(difficulty) {
  cpuDifficulty = difficulty;
  
  // Set CPU make rates based on difficulty
  if (difficulty === 'easy') cpuMakeRate = 0.3;
  else if (difficulty === 'medium') cpuMakeRate = 0.5;
  else if (difficulty === 'hard') cpuMakeRate = 0.7;
  else if (difficulty === 'insane') cpuMakeRate = 0.9;
  
  document.getElementById('difficultySelect').classList.add('hidden');
  document.getElementById('trickListSelect').classList.remove('hidden');
}

function backToModeSelect() {
  document.getElementById('difficultySelect').classList.add('hidden');
  document.getElementById('modeSelect').classList.remove('hidden');
}

function backToDifficulty() {
  document.getElementById('trickListSelect').classList.add('hidden');
  document.getElementById('difficultySelect').classList.remove('hidden');
}

function backToMenu() {
  // Reset game state
  scoreA = 0;
  scoreB = 0;
  setter = "A";
  turn = "A";
  tricks = [];
  availableTricks = [];
  attemptHistory = [];
  retryCount = 0;
  currentTrick = null;

  document.getElementById("scoreA").innerText = 0;
  document.getElementById("scoreB").innerText = 0;
  document.getElementById("cardsA").innerHTML = "";
  document.getElementById("cardsB").innerHTML = "";
  document.getElementById("middleCards").innerHTML = "";
  document.getElementById("currentTrick").innerText = "Press Draw Trick";
  document.getElementById("setterLine").innerText = "Setter: Player A";
  document.getElementById("newMatchBtn").style.display = "none";
  
  // Hide game screen and show menu
  document.getElementById('gameScreen').classList.remove('active');
  document.getElementById('menuScreen').style.display = 'flex';
  document.getElementById('trickListSelect').classList.add('hidden');
  document.getElementById('difficultySelect').classList.add('hidden');
  document.getElementById('modeSelect').classList.remove('hidden');
}

function startGame(listType) {
  if (listType === 'proOpen') {
    tricks = [...proOpenTricks];
  } else if (listType === 'top16') {
    tricks = [...top16Tricks];
  } else if (listType === 'beginnerOpen') {
    tricks = [...beginnerOpenTricks];
  } else if (listType === 'intermediateOpen') {
    tricks = [...intermediateOpenTricks];
  } else if (listType === 'advancedOpen') {
    tricks = [...advancedOpenTricks];
  } else if (listType === 'amOpen') {
    tricks = [...amOpenTricks];
  }
  
  availableTricks = [...tricks];
  
  // Update Player B name and buttons based on mode
  if (gameMode === 'cpu') {
    document.getElementById('playerBName').innerText = `CPU (${cpuDifficulty.charAt(0).toUpperCase() + cpuDifficulty.slice(1)})`;
    document.getElementById('makeBtn').classList.remove('hidden');
    document.getElementById('missBtn').classList.remove('hidden');
    document.getElementById('playerAPointBtn').classList.add('hidden');
    document.getElementById('playerBPointBtn').classList.add('hidden');
    document.getElementById('nullBtn').classList.add('hidden');
  } else {
    document.getElementById('playerBName').innerText = 'Player B';
    document.getElementById('makeBtn').classList.add('hidden');
    document.getElementById('missBtn').classList.add('hidden');
    document.getElementById('playerAPointBtn').classList.remove('hidden');
    document.getElementById('playerBPointBtn').classList.remove('hidden');
    document.getElementById('nullBtn').classList.remove('hidden');
  }
  
  document.getElementById('menuScreen').style.display = 'none';
  document.getElementById('gameScreen').classList.add('active');
  updateBorder();
  
  if (gameMode === 'cpu') {
    updateStatus("Draw a trick to begin");
  } else {
    updateStatus("");
  }
}

function updateBorder() {
  document.getElementById("currentTrickBox").style.borderColor = setter === "A" ? "red" : "blue";
}

function updateStatus(text) {
  document.getElementById("statusText").innerText = text;
}

function drawTrick() {
  if (availableTricks.length === 0) return;
  const idx = Math.floor(Math.random() * availableTricks.length);
  currentTrick = availableTricks.splice(idx, 1)[0];

  document.getElementById("currentTrick").innerText = currentTrick;
  document.getElementById("setterLine").innerText = `Setter: ${gameMode === 'cpu' && setter === 'B' ? 'CPU' : 'Player ' + setter}`;

  attemptHistory = [];
  retryCount = 0;
  turn = setter;
  updateBorder();
  
  if (gameMode === 'cpu') {
    const statusMsg = setter === 'B' ? `CPU chance to set` : `Player ${setter} chance to set`;
    updateStatus(statusMsg);
    
    // Trigger CPU attempt with delay if it's CPU's turn to set
    if (turn === 'B') {
      setTimeout(() => {
        cpuAttempt();
      }, 500);
    }
  } else {
    // Two player mode - clear status text
    updateStatus("");
  }
}

function quickPoint(player) {
  if (!currentTrick || gameMode !== 'two') return;
  awardPoint(player);
}

function quickNull() {
  if (!currentTrick || gameMode !== 'two') return;
  
  const middleDiv = document.getElementById("middleCards");
  const card = document.createElement("div");
  card.className = "card";
  card.innerText = currentTrick;
  card.style.display = "inline-block";
  card.style.margin = "5px";
  middleDiv.appendChild(card);
  
  endSet();
  setter = setter === "A" ? "B" : "A";
  document.getElementById("setterLine").innerText = `Setter: Player ${setter}`;
  updateBorder();
}

function recordMake() {
  if (!currentTrick) return;
  attemptHistory.push({ player: turn, result: "make" });
  processAttempt();
}

function recordMiss() {
  if (!currentTrick) return;
  attemptHistory.push({ player: turn, result: "miss" });
  processAttempt();
}

function cpuAttempt() {
  if (!currentTrick || gameMode !== 'cpu' || turn !== 'B') return;
  
  // CPU makes decision based on difficulty
  const madeIt = Math.random() < cpuMakeRate;
  
  // Highlight the button the CPU will "press"
  const buttonToHighlight = madeIt ? document.querySelector('button[onclick="recordMake()"]') : document.querySelector('button[onclick="recordMiss()"]');
  buttonToHighlight.classList.add('cpu-thinking');
  
  setTimeout(() => {
    buttonToHighlight.classList.remove('cpu-thinking');
    if (madeIt) {
      recordMake();
    } else {
      recordMiss();
    }
  }, 800); // Small delay to make it feel more natural
}

function processAttempt() {
  const a = attemptHistory;
  const opponentOfSetter = setter === "A" ? "B" : "A";

  if (a.length === 1) {
    const nextPlayer = turn === "A" ? "B" : "A";
    if (a[0].result === "make") {
      turn = nextPlayer;
      const statusMsg = gameMode === 'cpu' && nextPlayer === 'B' ? 
        `CPU chance to match` : `Player ${nextPlayer} chance to match`;
      updateStatus(statusMsg);
    } else {
      turn = nextPlayer;
      const statusMsg = gameMode === 'cpu' && nextPlayer === 'B' ? 
        `CPU chance for point` : `Player ${nextPlayer} chance for point`;
      updateStatus(statusMsg);
    }
    
    // Trigger CPU attempt with delay if it's CPU's turn
    if (gameMode === 'cpu' && turn === 'B') {
      setTimeout(() => {
        cpuAttempt();
      }, 500);
    }
    return;
  }

  if (a.length === 2) {
    const p1 = a[0].result;
    const p2 = a[1].result;

    if (p1 === "make" && p2 === "miss") {
      awardPoint(setter);
      return;
    }
    if (p1 === "miss" && p2 === "make") {
      awardPoint(opponentOfSetter);
      return;
    }
    if ((p1 === "make" && p2 === "make") || (p1 === "miss" && p2 === "miss")) {
      retrySet();
      return;
    }
  }
}

function retrySet() {
  retryCount++;
  
  if (retryCount >= 3) {
    // Trick is nulled - place in middle
    const middleDiv = document.getElementById("middleCards");
    const card = document.createElement("div");
    card.className = "card";
    card.innerText = currentTrick;
    card.style.display = "inline-block";
    card.style.margin = "5px";
    middleDiv.appendChild(card);
    
    endSet();
    setter = setter === "A" ? "B" : "A";
    document.getElementById("setterLine").innerText = `Setter: Player ${setter}`;
    updateBorder();
  } else {
    const statusMsg = gameMode === 'cpu' && setter === 'B' ? 
      `CPU chance to set` : `Player ${setter} chance to set`;
    updateStatus(statusMsg);
    attemptHistory = [];
    turn = setter;
    
    // Trigger CPU attempt with delay if it's CPU's turn to set
    if (gameMode === 'cpu' && turn === 'B') {
      setTimeout(() => {
        cpuAttempt();
      }, 500);
    }
  }
}

function awardPoint(player) {
  if (player === "A") scoreA++;
  else scoreB++;

  document.getElementById("scoreA").innerText = scoreA;
  document.getElementById("scoreB").innerText = scoreB;

  const pile = player === "A" ? document.getElementById("cardsA") : document.getElementById("cardsB");
  const card = document.createElement("div");
  card.className = "card";
  card.innerText = currentTrick;
  pile.appendChild(card);

  endSet();
  setter = setter === "A" ? "B" : "A";
  document.getElementById("setterLine").innerText = `Setter: Player ${setter}`;
  updateBorder();
  checkWin();
}

function endSet() {
  currentTrick = null;
  document.getElementById("currentTrick").innerText = "Draw Trick";
  
  if (gameMode === 'cpu') {
    updateStatus("Draw trick to begin");
  } else {
    updateStatus("Draw trick");
  }
}

function checkWin() {
  if (scoreA === 3 || scoreB === 3) {
    document.getElementById("newMatchBtn").style.display = "block";
  }
}

function newMatch() {
  scoreA = 0;
  scoreB = 0;
  setter = "A";
  turn = "A";
  availableTricks = [...tricks];
  attemptHistory = [];
  retryCount = 0;
  currentTrick = null;

  document.getElementById("scoreA").innerText = 0;
  document.getElementById("scoreB").innerText = 0;
  document.getElementById("cardsA").innerHTML = "";
  document.getElementById("cardsB").innerHTML = "";
  document.getElementById("middleCards").innerHTML = "";
  document.getElementById("newMatchBtn").style.display = "none";

  updateBorder();
  updateStatus("Draw a trick to begin");
}
</script>
</body>
</html>
